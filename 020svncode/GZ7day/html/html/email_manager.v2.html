<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<link href="../css/pub.css" rel="stylesheet" type="text/css" />
<script>
if(SysSetting.getEnv("LoadProgressFlag") == "0"){
	SysSetting.setLoadProgressFlag(1);
	SysSetting.setEnv("LoadProgressFlag", "1");
	window.location.reload();
}
</script>
<script src="../js/keyDefine.js"></script>
<script src="../js/config.js"></script>
<script src="../js/global2.0.js"></script> 
<script src="../js/GKey.js"></script>
<script src="../js/JAlex.js"></script>
<script src="../js/ajax_1.0.js"></script>
<script src="../js/DataCollection.js"></script>
<script>
	//SET ADD
	
	ADD_MO = "TVMail";
	ADD_MONAME = "自助服务"
	ADD_LE = 30;
	ADD_PA = "email_manager";
	ADD_NAME = "电视邮箱";
	ADD_OT = SysSetting.getEnv("PORTAL_ADDR");
	GKeyRetrun = true;
</script>
<style type="text/css">
.longTxt{
	text-overflow:ellipsis;
	white-space:nowrap;
	overflow:hidden;
}
</style>
</head>
<body>


<div class="systel_bg" style="background:url(../images/email_bg.jpg)">
  <div class="system_con_focus_02" id="focus_list" style="display:none;" ></div>
  <!--邮件选中高亮提示-->
  <!-- 弹出框 开始 -->
  <div class="tip_03_div" id="msgbox" style="display:none;">
    <div class="tip_box_bg_03"></div>
    <div class="tip_box_03_text"  >
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tip_box_03_table">
        <tr>
          <td width="63"><span class="tip_box_03_l"><img src="../images/see.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">查看邮件</span></td>
        </tr>
        <tr>
          <td width="63"><span class="tip_box_03_l"><img src="../images/delete.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">删除邮件</span></td>
        </tr>
        <tr>
          <td width="63"><span class="tip_box_03_l"><img src="../images/del_all.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">删除全部</span></td>
        </tr>
        <tr>
          <td width="63"><span class="tip_box_03_l"><img src="../images/returns_icon.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">返回</span></td>
        </tr>
      </table>
    </div>
    <div class="tip_box_focus_03" id="focus_msg" ></div>
  </div>
  <!-- 弹出框 结束 -->
  <div class="system_time">
    <div  class="weather"></div>
    <div id="time_HMS"></div><div id="time_YMDW"></div>
  </div>
  <!--<div class="system_menu_bg"></div>
  <div class="system_menu_title_bg"  style="left:968px;"></div>-->
  <!--标题高亮显示-->
  <div class="system_menu_text_box"> 电视邮箱管理</div>
 <!--  <div class="system_menu_text_box">
   <table width="1085" border="0" cellspacing="0" cellpadding="0" class="system_menu_title_cen">
      <tr>
        <td width="217"><span class="system_menu_text"> 系统信息</span></td>
        <td width="217"><span class="system_menu_text"> 节目搜索</span></td>
        <td width="217"><span class="system_menu_text"> 本机设置</span></td>
        <td width="217"><span class="system_menu_text"> 网络设置</span></td>
        <td width="217"><span class="system_menu_text"> 电视邮箱</span></td>
      </tr>
    </table>
  </div>-->
  <!--   
  function initPage(){
	 showDateTime();
   	for (var i=0;i<EMAIL_SIZE;i++){         
  		$("priority"+i).innerHTML  ="";   
  		$("id"+i).innerHTML ="";   
  		$("title"+i).innerHTML  =""; 
  		$("senderID"+i).innerHTML  =""; 
		$("arrivalTime"+i).innerHTML  =""; 
		$("cz"+i).innerHTML  =""; 
		 
     }-->
  <div class="system_con_box longTxt">
    <table width="1083" border="0" cellspacing="0" cellpadding="0" class="system_menu_table ">
      <tr class="pages_title">
        <td width="123" class="con_pad_left100">&nbsp;</td>
        <td width="229" >发件人</td>
        <td width="280" >标题</td>
        <td width="451">接收时间</td>
      </tr>
      <tr  class="list_font" id="list0">
        <td width="123" id="priority_0" class="con_pad_left100"></td>
        <td width="229" id="senderID_0"></td>
        <td width="280" id="title_0"></td>
        <td width="451" id="arrivalTime_0"></td>
      </tr>
      <tr  class="list_font" id="list1">
        <td width="123" id="priority_1" class="con_pad_left100"></td>
        <td width="229" id="senderID_1"></td>
        <td width="280" id="title_1"></td>
        <td width="451" id="arrivalTime_1"></td>
      </tr>
      <tr  class="list_font" id="list2">
        <td width="123" id="priority_2" class="con_pad_left100"></td>
        <td width="229" id="senderID_2"></td>
        <td width="280" id="title_2"></td>
        <td width="451" id="arrivalTime_2"></td>
      </tr>
      <tr  class="list_font" id="list3">
        <td width="123" id="priority_3" class="con_pad_left100"></td>
        <td width="229" id="senderID_3"></td>
        <td width="280" id="title_3"></td>
        <td width="451" id="arrivalTime_3"></td>
      </tr>
      <tr  class="list_font" id="list4">
        <td width="123" id="priority_4" class="con_pad_left100"></td>
        <td width="229" id="senderID_4"></td>
        <td width="280" id="title_4"></td>
        <td width="451" id="arrivalTime_4"></td>
      </tr>
    </table>
  </div>
  <div class="tip_02">
    <table width="1085" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="170"><table width="166" border="0" cellspacing="0" cellpadding="0">
            <tr>
              
            </tr>
          </table></td>
        <td width="166"><table width="166" border="0" cellspacing="0" cellpadding="0">
            <tr>

            </tr>
          </table></td>
        <td width="165">&nbsp;</td>
        <td width="242">&nbsp;</td>
        <td width="153"><span class="white_02" id="emailNum">&nbsp;</span></td>
        <td width="189"><span class="white_02" id="remainEmailNum">&nbsp;</span></td>
      </tr>
    </table>
  </div>
</div>

<script> 
//try{
var page = new JPage();
page.grabEvent.pageEvent = function pageEvent(event){
	var val = event.which|event.keycode;
	switch(val){  
		case ROC_IRKEY_SELECT:   
			  if(pageObj.emailInfoList.isEvenSelect){  //当频道的ok事件时与弹出行为框有冲突，用pageObj.emailInfoList.isEvenSelect变量来处理
			  		pageObj.emailInfoList.isEvenSelect = false;
				  	pageObj.tipDivControl.showTag = true;
					pageObj.tipDivControl.init();
				 return false;
			  }
		break; 
	}
	return true;
}
//}catch(e){}

function grabEvent(event){
	return page.grabEvent.Listener(event); 
}

function page_systemevent_handler(event){
	page.grabEvent.Listener(event);
	return true;
}

function pageObj(){
	 
	this.emailInfoList = new emailInfoList();  //纵向
	function emailInfoList(){
		this.index = 0;   
		this.pageSize = 5;//横向总栏目数
		this.top = 288;
		this.height = 66;	 
		this.items = new Array();  
		this.page = 0; 
		this.maxPage = 0;
		this.showTag = true; 
		this.isEvenSelect = false;
		this.email = ["priority","readFlag"];
		this.emailFlagImg = [
				["../images/Unread_messages.png","../images/Has_read_email.png"],
				["../images/Unread_key_mail.png","../images/Has_read_key_mail.png"]
				];//priority:1为重要，0为普通  readFlag:1为已读，0为未读

		this.init = function(items){ 
			this.items = items; 
			this.index = $G.getParameter("index");
			if(this.index==''){
				this.index = 0;	
			}else{
				this.index = parseInt(this.index);	
			}
			this.page = Math.ceil((this.index + 1)/this.pageSize) - 1;
			this.maxPage = Math.ceil(this.items.length / this.pageSize) - 1;
			if(!this.initEmailNum()){
				return;
			}
			this.showData(); 
			//this.focusOff(0);
			this.focusOn(this.index);   
		} 
		this.initEmailNum = function(){
			var flag = false;
			if(this.items && this.items.length > 0){ 
				$("focus_list").style.display="block";  
				flag = true;
			}else{
				$("list0").innerHTML="<td colspan='4' style='color:#000000; text-align:center;'>收件箱为空</td>";
			}
			$("emailNum").innerHTML="已存："+CAMails.emailNum;;
			$("remainEmailNum").innerHTML="剩余容量："+CAMails.remainEmailNum;	
			return flag;
		}
		this.getStep = function(idx){  
			return this.top + this.height * (idx % this.pageSize); 
		} 
		this.showData = function(){
			this.initResetPage(); 
			var idx = this.pageSize * this.page;
			for(var i=0;i<Math.min(this.pageSize,this.items.length-this.pageSize*this.page);i++){ 
				var readFlag = 0;
				if(this.items[idx+i].readFlag){
					readFlag = 1;
				}
				$("priority_"+i).innerHTML ="<img src="+ this.emailFlagImg[this.items[idx+i].priority][readFlag]+" />";
				$("senderID_"+i).innerHTML =getStrChineseLength(this.items[idx+i].senderID)>6?getStrChineseLen(this.items[idx+i].senderID,6)+".":this.items[idx+i].senderID;
				$("title_"+i).innerHTML =getStrChineseLength(this.items[idx+i].title)>8?getStrChineseLen(this.items[idx+i].title,8)+".":this.items[idx+i].title;
				$("arrivalTime_"+i).innerHTML  =this.items[idx+i].arrivalTime;	   
			}
		}
		this.initResetPage = function(){
			 for(var i=0;i< this.pageSize;i++){
				  	$("priority_"+i).innerHTML  ="";
					$("senderID_"+i).innerHTML ="";   
					$("title_"+i).innerHTML  =""; 
					$("arrivalTime_"+i).innerHTML  ="";
			  }
		}
		this.focusOff = function(i){
			$("senderID_"+i).innerHTML =getStrChineseLength(this.items[this.index].senderID)>6?getStrChineseLen(this.items[this.index].senderID,6)+".":this.items[this.index].senderID;
			$("title_"+i).innerHTML =getStrChineseLength(this.items[this.index].title)>8?getStrChineseLen(this.items[this.index].title,8)+".":this.items[this.index].title;
			$("list"+i).className = "list_font";
		}
		this.focusOn = function(i){
			$("focus_list").style.top=this.getStep(i)+"px";
			var idx = i % this.pageSize; 
			if(getStrChineseLength(this.items[i].senderID) > 6)
			{
				$("senderID_"+ idx).innerHTML = "<marquee width=179px>"+this.items[i].senderID+"</marquee>";
			}
			if(getStrChineseLength(this.items[i].title) > 8)
			{
				$("title_"+ idx).innerHTML = "<marquee width=241px>"+this.items[i].title+"</marquee>";
			}
			$("list"+idx).className = "list_font font32"; 
		} 
		this.up = function(){
			if(!this.items || this.items.length<=0) return;
			this.focusOff(this.index % this.pageSize);
			var oldpage = Math.ceil((this.index + 1)/this.pageSize) - 1;
			this.index = this.index == 0 ? this.items.length - 1: this.index -1;
			this.page = Math.ceil((this.index + 1)/this.pageSize) - 1;
			if(oldpage!=this.page){
				this.showData();
			}
			this.focusOn(this.index);  
		}
		this.down = function(){ 
			if(!this.items || this.items.length<=0) return;
			this.focusOff(this.index % this.pageSize);
			var oldpage = Math.ceil((this.index + 1)/this.pageSize) - 1;
			this.index = this.index == this.items.length - 1 ? 0 : this.index + 1;
			this.page = Math.ceil((this.index + 1)/this.pageSize) - 1;  
			if(oldpage != this.page){
				this.showData();
			}
			this.focusOn(this.index);  
		}
		this.pageUp = function(){
			if(!this.items || this.items.length<=0) return;
			this.focusOff(this.index % this.pageSize);
			this.page = this.page == 0 ? this.maxPage : --this.page;
			this.index = this.page * this.pageSize;
			this.showData();
			this.focusOn(this.index);
		}
		this.pageDown = function(){
			if(!this.items || this.items.length<=0) return;
			this.focusOff(this.index % this.pageSize);
			this.page = this.page == this.maxPage ? 0 : ++this.page;
			this.index = this.page * this.pageSize;
			this.showData();
			this.focusOn(this.index);
		}
		this.select = function(){
			if(this.items.length ==0 ){
				this.isEvenSelect = false;
			}else{
				this.showTag = false; 
				this.isEvenSelect = true;
			}
		}
		this.Listener = function(event){ 
			var val = event.which | event.keyCode; 
			if(this.showTag ){ 
				switch(val){
					case ROC_IRKEY_DOWN: 
						this.down();
						return false;
					break;
					case ROC_IRKEY_UP: 
						this.up();
						return false;
					break; 
					case ROC_IRKEY_PAGE_DOWN : 
						this.pageDown();
						return false;
					break; 
					case ROC_IRKEY_PAGE_UP : 
						this.pageUp();
						return false;
					break;
					case ROC_IRKEY_SELECT:
						this.select();
						return true;
					break;
				}  
			} 
			return true;
		} 
	} 
	
	this.tipDivControl = new tipDivControl(this); 
	function tipDivControl(){   //属性设置框
		this.showTag = false;  
		this.focusBarTop = 30;
		this.focusbarHeight = 59;
		this.pageSize = 4;
		this.index = 0;
		
		this.init = function(){  
			this.index = 0; 
			this.showData(true);
		} 
		this.showData = function(isDisplay){  
			  this.show();  
			  this.focusOn(); 
		} 
		this.show = function(){
			$("msgbox").style.display = "block";
		}
		this.hide = function(){
			$("msgbox").style.display = "none";
		} 
		this.focusOn = function(focusTop){
			var focusTop = this.focusBarTop + this.index * this.focusbarHeight
			$("focus_msg").style.top = focusTop+"px";
		}
		this.up = function(){
			if(this.index == 0){
				this.index = 3;
			}else{
				this.index --;
			}
			this.focusOn();
		}
		this.down = function(){
			if( this.index == 3){
				this.index =0;
			}else{
				this.index ++;
			}
			this.focusOn();
		}
		this.back = function(){
			this.showTag = false;
			this.hide();
			pageObj.emailInfoList.showTag = true;  
		}
		this.exit = function(){
			this.showTag = false;
			this.hide();  
		}
		this.select = function(){   
			switch(this.index){
			   case 0: 
				 location.href="mailDetail.v2.html?index="+pageObj.emailInfoList.index; 
			   break;
			   case 1:
				 CAMails.deleteEmail(pageObj.emailInfoList.index );
				 location.href = "email_manager.v2.html";
			   break;
			   case 2:
				 CAMails.deleteAllEmail();
				 location.href = "email_manager.v2.html";
			   break;
			   case 3:
				  $("msgbox").style.display='none';
			   break; 
			}
			this.showTag = false;
			this.hide();
			pageObj.emailInfoList.showTag = true; 
		} 
		this.Listener = function(event){
			var val = event.which | event.keyCode; 
			if(this.showTag){
				switch(val){    
					case ROC_IRKEY_UP: 
						this.up();
						return false;
					break;
					case ROC_IRKEY_DOWN:  
						this.down();
						return false;
					break; 
					case ROC_IRKEY_SELECT:
						this.select();
						return false;
					break; 
					case ROC_IRKEY_EXIT: 
						 this.exit();  
						 return true;
					break;
					case ROC_IRKEY_BACK: 
						 this.back(); 
						 return false;
					break;
				}
			}
			return true;
		}
	}
	 
	this.init = function(){ 
		var mails=CA.getMails();

		//mails=[{ID:"1",readFlag:"0",priority:"1",senderID:"东方广视互动电视",title:"五月份有优五月份有优惠活动，敬请关注！",arrivalTime:"1900-05-31 23:59:59"},{ID:"2",readFlag:"1",priority:"1",senderID:"重已：",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"3",readFlag:"0",priority:"0",senderID:"普未：",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"4",readFlag:"1",priority:"0",senderID:"普已：",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"5",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"6",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"7",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"8",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"9",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"10",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"},{ID:"11",readFlag:"1",priority:"1",senderID:"运营商ID",title:"test",arrivalTime:"1900-05-31 23:59:59"}];
		 if (mails) {
			this.emailInfoList.init(mails);	
		 }
		showDateTime(); 
	} 
} 

try{
	//注册页面
	var pageObj = new pageObj();  
	page.regedit(pageObj.emailInfoList);
	page.regedit(pageObj.tipDivControl); 
}catch(e){
	//alert(e.message)
}	

function initPage(){
		pageObj.init();
		DataCollection.collectData(["01","main://html/html/email_manager.v2.html"+window.location.search,SysSetting.getEnv("SOURCE_PATH"),"电视邮箱"]);
		SysSetting.setEnv("SOURCE_PATH","main://html/html/email_manager.v2.html"+window.location.search);
}

window.onload = initPage;
 
</script>

<script src="../js/ADD_C.js"></script>


</body>
</html>
