<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>频道编辑</title>
<link href="../css/pub.css" rel="stylesheet" type="text/css" /> 
<script src="../js/keyDefine.js"></script>
<script src="../js/config.js"></script>
<script src="../js/global2.0.js"></script>
<script src="../js/GKey.js"></script>
<script src="../js/JAlex.js"></script>
<script src="../js/ajax_1.0.js"></script>
<script src="../js/DataCollection.js"></script>
<script>
	ADD_MO = "chan_editor";
	ADD_MONAME = "自助服务|频道编辑"
	ADD_LE = 31;
	ADD_PA = "channel_voice";  
	ADD_NAME = "频道音量偏移编辑";  
	ADD_OT = SysSetting.getEnv("PORTAL_ADDR");
	
</script>

<style>
   .channel_icon {
	height:59px;
	width:60px;
	visibility:hidden;
	margin:0px;
}
</style>
</head>
  
<body>

<div class="systel_bg" style="background:url(../images/channel_manager.jpg)">
<div class="tip_box_bg" id="tip_box_bg">
    	<div class="tip_box_title" id="tip_box_title">提 示</div>
        <div class="tip_box_text" id="tip_box_text">提示</div>
   	<div class="tip_box_button_01" id="tip_box_button_01"><img src="../images/ok_02.png" width="190" height="60" id="tip_box_img_01"/></div>
    	<div class="tip_box_button_02" id="tip_box_button_02"><img src="../images/cancel.png" width="190" height="60" id="tip_box_img_02" /></div>
   	  <!--<div class="tip_box_button_03"><img src="../images/cancel.png" width="190" height="60" /></div>-->
    </div>
    
<div class="tip_box_bg" id="tip_box_bg_1">
    	<div class="tip_box_title" id="tip_box_title_1">提 示</div>
        <div class="tip_box_text" id="tip_box_text_1">提示</div>
   	
   	  <!--<div class="tip_box_button_03"><img src="../images/cancel.png" width="190" height="60" /></div>-->
      </div>
</div>
<div class="tip_03_div" id="tip_03_div">
    <div class="tip_box_bg_03"></div>
    <div class="tip_box_03_text">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tip_box_03_table">
        <tr>
          <td width="63"><span class="tip_box_03_l" id="selectTag_0"><img src="../images/love.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">设为喜爱</span></td>
        </tr>
        <tr>
          <td width="63"><span class="tip_box_03_l"  id="selectTag_1"><img src="../images/move_ico.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r" >移动频道</span></td>
        </tr>
        <tr>
          <td width="63"><span class="tip_box_03_l" id="selectTag_2"><img src="../images/lock.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">频道加锁</span></td>
        </tr>
        <tr>
          <td width="63"><span class="tip_box_03_l" id="selectTag_3"><img src="../images/delete.png" width="60" height="59" /></span></td>
          <td width="169"><span class="tip_box_03_r">频道删除</span></td>
        </tr>
      </table>
    </div>
    <div class="tip_box_focus_03" id="tip_box_focus_03"></div>
  </div>
<div class="system_time">
    <div  class="weather"></div>
    <div id="time_HMS"></div><div id="time_YMDW"></div>
  </div>
<div class="system_menu_text_box" id="system_menu_text_box"></div>
  <div class="system_con_focus" id="system_con_focus"></div>
<div class="system_con_focus_02" id="focus_list"></div>
<div class="system_con_box">
    <table width="1083" border="0" cellspacing="0" cellpadding="0" class="system_menu_table ">
      <tr class="pages_title">
        <td width="649" class="con_pad_left100">频道列表</td>
        <td width="88">&nbsp;</td>
        <td width="176" id="th_title" align="center">音量调整</td>
        <td width="88">&nbsp;</td>
      </tr>
      <tr  class="list_font" id="tr_0">
        <td  class="con_pad_left100">
        <span id="chan_id_0"></span>&nbsp;&nbsp;
        <span id="chan_name_0"></span>
        </td>
        <td  ><div id="left_0"><img src="../images/gtk-left.png"  style="float:right;"/></div></td>
        <td ><div id="voice_0" style="font-size:36px;height:50px;text-align:center; line-height:50px"></div></td>
        <td ><div id="right_0"><img src="../images/gtk-right.png" /></div></td>
      </tr>
      <tr  class="list_font"  id="tr_1">
        <td  class="con_pad_left100">
            <span id="chan_id_1"></span>&nbsp;&nbsp;
            <span id="chan_name_1"></span>
        </td>
        <td  ><div id="left_1"><img src="../images/gtk-left.png" style="float:right;"/></div></td>
        <td ><div id="voice_1" style="  font-size:36px; height:50px; text-align:center; line-height:50px"></div></td>
        <td><div id="right_1"><img src="../images/gtk-right.png" /></div></td>
      </tr>
      <tr  class="list_font"  id="tr_2">
        <td class="con_pad_left100">
            <span id="chan_id_2"></span>&nbsp;&nbsp;
            <span id="chan_name_2"></span>
        </td>
        <td ><div id="left_2"><img src="../images/gtk-left.png" style="float:right;"/></div></td>
        <td ><div id="voice_2" style="  font-size:36px; height:50px; text-align:center; line-height:50px"></div></td>
        <td><div id="right_2"><img src="../images/gtk-right.png" /></div></td>
      </tr>
      <tr  class="list_font" id="tr_3">
        <td  class="con_pad_left100">
           <span id="chan_id_3"></span>&nbsp;&nbsp;
            <span id="chan_name_3"></span>
        </td>
        <td  ><div id="left_3"><img src="../images/gtk-left.png" style="float:right;"/></div></td>
        <td><div id="voice_3" style="  font-size:36px; height:50px; text-align:center; line-height:50px"></div></td>
        <td ><div id="right_3"><img src="../images/gtk-right.png" /></div></td>
      </tr>
      <tr  class="list_font"  id="tr_4">
        <td  class="con_pad_left100">
            <span id="chan_id_4"></span>&nbsp;&nbsp;
            <span id="chan_name_4"></span>
        </td>
        <td ><div id="left_4"><img src="../images/gtk-left.png" style="float:right;"/></div></td>
        <td><div id="voice_4" style="  font-size:36px; height:50px; text-align:center; line-height:50px"></div></td>
        <td><div id="right_4"><img src="../images/gtk-right.png" /></div></td>
      </tr>
    </table>
  </div>
<div class="tip_02">
  <table width="342" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td width="171">
      <table width="166" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td width="137"><img src="../images/tip_returns.png" width="137" height="23" /></td>
        </tr>
      </table></td>
      

    </tr>
  </table>
</div>
</div>


<script>
PRINT_PREFIX = "[channel_manager]";
var changeDataFlae = false;//标记是否更改音量补偿
//try{
var page = new JPage();
page.grabEvent.pageEvent = function pageEvent(event){
	var val = event.which|event.keycode;
	switch(val){  
		case ROC_IRKEY_SELECT:   
			  if(pageObj.channelListObj.isEvenSelect){  //当频道的ok事件时与弹出行为框有冲突，用pageObj.channelListObj.isEvenSelect变量来处理
			  		pageObj.channelListObj.isEvenSelect = false;
				  	pageObj.tipDivControl.showTag = true;
					pageObj.tipDivControl.init();
				 return false;
			  }
		break; 
	}
	return true;
}
//}catch(e){}
var saveTipObj = new channelEditorSava();

function grabEvent(event){
	if(saveTipObj.showTag){
		saveTipObj.Listener(event);
	} else{
		var val = event.which | event.keyCode;
		switch(val){ 
			case ROC_IRKEY_BACK: 
			case ROC_IRKEY_EXIT:
			case ROC_IRKEY_SELECT:
				if(changeDataFlae){
					saveTipObj.showTip();
				} else {
					history.back();
				}
				return false;
			break; 
		}	
		return page.grabEvent.Listener(event); 
	}
}

function page_systemevent_handler(event){
	page.grabEvent.Listener(event);
	return true;
}

function pageObj(){
	this.groupList = null;
	this.ChannelTypeName = "";

		//获取频道类型
	this.getChanType = function(){
		/*this.isTVList = $G.getParameter("isTVList");
		if(this.isTVList == "")
			this.isTVList = 1;
		
		this.groupList = getEditGroupList(this.isTVList); */ 
		this.groupList = getEditGroupList();
		ADD_NAME = this.groupList.GroupName; 
		
	}
	
		
	this.channelListObj = new channelListObj();
	function channelListObj(){ 
		this.showTag = true;
		this.page = 0;
		this.maxPage = 0;
		this.index = 0;
		this.pageSize = 5;
		this.focusBarTop = 288;
		this.focusbarHeight = 66; 
 
		this.maxSize = 0; 
		
		this.init = function(){
			this.maxSize = pageObj.groupList.GroupInfo.length;
			this.maxPage = Math.max(Math.ceil((this.maxSize) / this.pageSize) - 1, 0);
			this.index = 0; 
			this.page = 0; 
			this.showData();
			this.setfocus(); 
		}  		
		this.getFocusChannel = function(){ 
			return this.maxSize <= 0 ? null : pageObj.groupList[this.index]; 
		} 
		this.getChanneByIndex = function(_index){  
			return this.maxSize <= 0 ? null : pageObj.groupList[_index]; 
		}
		this.showData = function(){
			var len = this.maxSize;
			for(var i=0;i<this.pageSize;i++){
				$("tr_"+i).className="list_font";
				$("chan_id_"+i).innerHTML = "";
				$("chan_name_"+i).innerHTML = ""; 
				
				$("left_"+i).style.visibility = "hidden";
				$("voice_"+i).style.visibility = "hidden"; 
				$("right_"+i).style.visibility = "hidden";
				 
			} 			
			for(var i=0;i<Math.min(this.pageSize,len-this.pageSize*this.page);i++){ 
				var idx = this.pageSize * this.page; 
			
				$("chan_id_"+i).innerHTML = pageObj.groupList.GroupInfo[idx + i].ChannelNumber;
                $("chan_name_"+i).innerHTML = pageObj.groupList.GroupInfo[idx + i].ServiceName
				  
				this.showProp(idx+i);
			} 
		}
		this.showProp = function(idx){
			var pageIdx = idx % this.pageSize; 
			var persent;
		    if(VOLUME_HANDLE.enableGlobalVolume()){
			    persent = channelInfoObj[pageObj.groupList.GroupInfo[idx]["ServiceHandle"]]["offset"];
				$("voice_"+pageIdx).style.visibility = "visible";
				$("left_"+pageIdx).style.visibility = "visible";
				$("right_"+pageIdx).style.visibility = "visible";
				$("voice_"+pageIdx).innerHTML = persent;
		    }else{
				persent = channelInfoObj[pageObj.groupList.GroupInfo[idx]["ServiceHandle"]]["offset"];
			    $("voice_"+pageIdx).style.visibility = "visible";
				$("left_"+pageIdx).style.visibility = "hidden";
				$("right_"+pageIdx).style.visibility = "hidden";
				$("voice_"+pageIdx).innerHTML = persent;	
		    }
			
		}
		this.focusOff = function(){
			$("tr_"+(this.index % this.pageSize)).className="list_font";
		}
		this.focusOn = function(i){
			$("tr_"+(this.index % this.pageSize)).className="list_font font32"; 
		}
		this.setfocus = function(){ 
			var tops = parseInt(this.focusBarTop + this.focusbarHeight * (this.index%this.pageSize));
    		$("focus_list").style.top = tops+"px";
			this.focusOn();   
		}
		this.pageUp = function(){
			this.focusOff();
			this.page = this.page == 0 ? this.maxPage : this.page - 1;
			this.index = this.page * this.pageSize;
			this.showData();
			this.setfocus();		
		}
		this.pageDown = function(){
			this.focusOff();
			this.page = this.page == this.maxPage ? 0 : this.page + 1;
			this.index = this.page * this.pageSize;
			this.showData();
			this.setfocus();
		}
		this.up = function(){
			this.focusOff();
			var oldpage = Math.ceil((this.index + 1)/this.pageSize) - 1;
			this.index = this.index == 0?this.maxSize-1: this.index -1;
			this.page = Math.ceil((this.index + 1)/this.pageSize) - 1;
			if(oldpage!=this.page){this.showData()}
			this.setfocus(); 
		}
		this.down = function(){
			this.focusOff();
			var oldpage = Math.ceil((this.index + 1)/this.pageSize) - 1;
			this.index = this.index == this.maxSize-1?0: this.index +1;
			this.page = Math.ceil((this.index + 1)/this.pageSize) - 1;
			if(oldpage!=this.page){this.showData()}
			this.setfocus();  
		}
		this.left = function(){ 
			if(VOLUME_HANDLE.enableGlobalVolume()){
				var focusChannel = this.getFocusChannel();
				var val = channelInfoObj[pageObj.groupList.GroupInfo[this.index]["ServiceHandle"]]["offset"];
				if(val>-16){
				  --channelInfoObj[pageObj.groupList.GroupInfo[this.index]["ServiceHandle"]]["offset"];
				  this.showProp(this.index);
				}
			}
		}
		this.right = function(){ 
			if(VOLUME_HANDLE.enableGlobalVolume()){
				var focusChannel = this.getFocusChannel();
				var val = channelInfoObj[pageObj.groupList.GroupInfo[this.index]["ServiceHandle"]]["offset"]
				if(val<16){
				  ++channelInfoObj[pageObj.groupList.GroupInfo[this.index]["ServiceHandle"]]["offset"];
				  this.showProp(this.index);
				}
			}
		}
		this.Listener = function(event){
			var val = event.which | event.keyCode; 
			if(this.showTag){
				switch(val){
					case ROC_IRKEY_UP:
						this.up();
						return false;
					break;
					case ROC_IRKEY_DOWN:
						this.down();
						return false;
					break; 	 
					case ROC_IRKEY_LEFT:
						changeDataFlae = true;
						this.left();
						return false;
					break;
					case ROC_IRKEY_RIGHT:
						changeDataFlae = true;
						this.right();
						return false;
					case ROC_IRKEY_PAGE_UP:
						this.pageUp();
						return false;
					case ROC_IRKEY_PAGE_DOWN:
						this.pageDown();
						return false;
					break;
				}  
			}
			return true;
		} 
	} 
 
	this.initTitle = function(){  
			if(VOLUME_HANDLE.enableGlobalVolume()){
					$("th_title").innerText = "音量偏移";	
			}else{
					$("th_title").innerText = "音量偏移";	
			}
		  	$("system_menu_text_box").innerHTML = ADD_NAME ;	 
	}
	this.init = function(){   
		this.getChanType();
		this.channelListObj.init(); 
		this.initTitle();
		showDateTime(); 
	} 
} 

function channelEditorSava(){ 
	this.showTag = false;
	this.isSave = true;
	
	this.init = function(){ 
		this.showData("visible");
		this.left(); //默认选中确定
	} 
	this.showTip= function(){ 
		this.showTag = true;
		$("tip_box_text").innerHTML = "是否保存所有音量变动?";
		$("tip_box_bg").style.display= "block";  
	}
	this.left = function(){
		$("tip_box_img_01").src = "../images/ok_02.png";
		$("tip_box_img_02").src = "../images/cancel.png"; 
		this.isSave = true; 
	}
	this.right = function(){
		$("tip_box_img_01").src = "../images/ok.png";
		$("tip_box_img_02").src = "../images/cancel_02.png";
		this.isSave = false; 
	}
	this.select = function(){
		history.back();
	}
	this.Listener = function(event){
		var val = event.which | event.keyCode;
		switch(val){ 
			case ROC_IRKEY_LEFT:
				this.left();
				return false;
			break;
			case ROC_IRKEY_RIGHT:
				this.right();
				return false;
			break;
			case ROC_IRKEY_BACK: 
			case ROC_IRKEY_EXIT:
			case ROC_IRKEY_SELECT:
				this.select();
			break; 
		}
		return false;
	}
}	
//try{
//注册页面
var pageObj = new pageObj();
page.regedit(pageObj.channelListObj);  
pageObj.init();
DataCollection.collectData(["01","main://html/html/channel_voice.v2.html"+window.location.search,SysSetting.getEnv("SOURCE_PATH"),"频道音量偏移编辑"]);
SysSetting.setEnv("SOURCE_PATH","main://html/html/channel_voice.v2.html"+window.location.search);
//var saveTip= new channelEditorSava();
//saveTip.init();
//}catch(e){alert(e.message)}

function exitPage(){
	if(saveTipObj.isSave){
		saveChannelInfoFile();
	}
	//saveChannelInfoFile();
	//saveTip.showTip();
}
window.onunload = exitPage;



</script>

<script src="../js/ADD_C.js"></script>

</body>
</html>

